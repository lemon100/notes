# 第2章 数据表示、寻址方式与指令系统

### 2.1 数据表示

**数据表示**指的是能由计算机硬件识别和引用的数据类型。**数据结构**和数据表示是软、硬件的交界面。系统结构设计在软、硬件功能分配时，应考虑在计算机中设置哪些数据表示，以便对应用中的数据结构有高的实现效率。在确定数据表示时应考虑怎样为数据结构的实现提供进一步的支持，引入一些高级数据表示，这比在指令系统中增设技巧性新指令的意义要大。  

#### 2.1.1 引入数据表示的原则：
- 看系统的效率是否显著提高，包括实现时间和存储空间是否有显著减少；
- 看引入这种数据表示后，其通用性和利用率是否提高；

#### 2.1.2 标志符数据表示的优点，与数据描述符的差别：

1. 标志符数据表示的优点：
   - 简化了指令系统和程序设计；
   - 简化了编译程序； 
   - 便于实现一致性校验；
   - 能由硬件自动变换数据类型；
   - 支持数据库系统的实现与数据类型无关的要求，使程序不用修改即可处理多种不同类型数据；
   - 为软件调试和应用软件开发提供了支持。
2. 与数据描述符的差别：
   -  标志符是和每个数据相连的，合存在一个存储单元中，描述单个数据的类型特征；
   - 数据描述符是与数据分开存放，用于描述所要访问的数据是整块的还是单个的，访问该数据块或数据元素所要的地址以及其他信息等。

#### 2.1.3 堆栈机器（堆栈数据表示）和向量数据表示的基本特征。

1. 堆栈机器的基本特征：
   -  有堆栈数据表示的计算机称为堆栈计算机；
   - 由高速寄存器组成的硬件堆栈，并附加控制电路，让它与主存中的堆栈区在逻辑上构成整体，使堆栈的访问速度是寄存器的，容量是主存的；
   - 有丰富的堆栈操作指令且功能很强，可直接对堆栈中的数据进行各种运算和处理；
   - 有力地支持了高级语言程序的编译；
   - 有力地支持了子程序的嵌套和递归调用。
2. 向量数据表示的基本特征：
      向量数组数据表示为向量、数组数据结构的实现和快速运算提供了更多的硬件支持,表现于在硬件上设置有丰富的向量或阵列(数组)运算类指令, 配有流水线或处理单元阵列等高速的运算部件, 直接高效支持对向量、数组的访问、运算、压缩、还原、归并等的 处理。向量处理机就是有向量数据表示的处理机。虽然标量处理机也能处理向量、数组, 但它是用标量指令通过变址和循环来实现的, 其速度和效能自然要比向量处理机低得多。

#### 2.1.4 浮点数尾数的下溢处理方法

1. 截断法：将尾数超出计算机字长的部分截去；
2. 舍入法：在计算机运算的规定字长之外增设一位附加位，存放溢出部分的最高位，每当进行尾数下溢处理时，讲附加位加1；
3. 恒置“1”法：将计算机运算的规定字长的最低位恒置为“1”。
4. 查表舍入法：用ROM或PLA存放下溢处理表。ROM 表存储器的容量为2K 个单元, 每个单元字长为K - 1 位。下溢处理表的内容设置一般采用的方法是:当K 位数据的高K - 1 位为全“1”时, 让那些单元按截断法填入K - 1 位全“1”, 其余单元都按最低位(即附加位) 0 舍1 入的结果来填其内容。

### 2.2 寻址方式

面向主存的寻址主要访问主存，少量访问寄存器；面向寄存器的寻址主要访问寄存器，少量访问主存和堆栈；面向堆栈的寻址方式主要访问堆栈，少量访问主存或寄存器。**逻辑地址**是程序员编程用的地址，**物理地址**是程序在主存中的实际地址。

#### 2.2.1 寻址方式在指令中的指明

- 一种方式是占用操作码的某些位来指明。
- 另一种方式是不占用操作码，而是在地址码部分专门设置寻址方式位字段指明。寻址方式位的寻址灵活，操作码短，但需要专门的寻址方式位字段。

#### 2.2.2 程序的静态再定位和动态再定位的含义和实现

- 静态再定位：在目的的程序装入主存时，由装入程序用软件方法把目的程序的逻辑地址变换为物理地址，程序执行时，物理地址不再改变。
- 动态再定位：在程序不做变化直接装入主存的同时，将装入主存的起始地址存入对应该道程序使用的基址寄存器中。程序执行时，只要通过地址加法器将逻辑地址加上基址寄存器的程序基址形成物理地址后去访问即可。

#### 2.2.3 信息在内存中按整数边界存储的含、存在问题和适用场合

- 含义：信息在主存中存放的地址必须是该信息宽度（字节数）的整数倍。
- 存在问题：会造成存储空间的某些浪费。
- 适用场合：早期的小、微型机由于运算速度低，主存容量小，不一定非要按主存整数边界存储；巨、大、中型机存储容量大，速度要求高，信息都按主存整数边界存储。

### 2.3 指令系统的设计和优化

#### 2.3.1 指令格式优化的含义

指令是由**操作码**和**地址码**两部分组成的。就指定格式优化来说，是指如何用最短的位数来表示指令的操作信息和地址信息，使程序中指令的平均字长最短。

#### 2.3.2 哈夫曼压缩概论的基本思想

当各种事件发生的概率不均等时，采用优化技术，对发生概率最高的时间用最短的位数（时间）来表示（处理），而对出现概率较低的时间允许用较长的位数（时间）来表示（处理），就会使表示（处理）的平均位数（时间）缩短。

#### 2.3.3 拓展操作码编码

是界于定长二进制编码和完全的哈夫曼编码之间的一种编码方式，操作码不是定长的，但只有有限的集中码长。仍利用高概率的用短码、低概率的用长码表示的哈夫曼压缩思想，是操作码平均长度缩短，以降低信息冗余信息。  
拓展操作码必须遵守**短码不能是长码的前缀的原则**。拓展操作码的编码不唯一，平均码长也不唯一。

#### 2.3.4 指令格式优化设计措施

- 采用扩展操作码，并根据指令的频度Pi的分布状况选择合适的编码方式，以缩短操作码的平均码长；
- 采用诸如基址、变址、相对、寄存器、寄存器间接、段式存放、隐式指明等多种寻址方式，以缩短地址码的长度，并在有限的地址长度内提供更多的地址信息；
- 采用0、1、2、3等多种地址制，以增强指令的功能，加快程序的执行速度；
- 在同种地址制内再采用多种地址形式，如寄存器-寄存器、寄存器-主存、主存-主存等，让每种地址字段可以有多种长度，且让长操作码与短地址码进行组配；
- 在维持指令字在存储器中按整数边界存储的前提下，使用多种不同的指令字长度。

### 2.4 指令系统的发展和改进

复杂指令计算机(CISC)：从增强原有指令的功能以及设置更为复杂的新指令以取代原先由软件子程序完成的功能，实现软件功能的硬化。  
精简指令系统计算机(RISC)：通过减少指令种类和简化指令功能来降低硬件设计的复杂度，提高指令的执行速度。

#### 2.4.1 面向目标程序优化实现改进指令系统的目标和思路

- 通过对大量已有机器的机器语言程序及其执行情况，统计各种指令和指令串的使用频度来加以分析和改进；
- 增设强功能复合指令来取代原先由常用宏指令或子程序实现的功能，由微程序解释实现，不仅大大提高了运算速度，减少了程序调用的额外开销，也减少了子程序所占用的主存空间。

#### 2.4.2 面向高级语言优化实现改进指令系统的目标和思路

- 对源程序中各种高级语言语句的使用频度进行统计来分析改进；
- 如何面向编译，优化代码生成来改进；
- 改进指令系统，使它与各种语言间的语义差距都有同等的缩小；
- 提出采用让计算机具有分别面向各种高级语言的多种指令系统、多种系统结构的面向问题动态自寻优的计算机系统；
- 发展高级语言计算机。

#### 2.4.3 高级语言机器的定义和两种形式，高级语言机器难以发展的原因

高级语言机器的基本特点是没有编译。一种是让高级语言直接成为机器的汇编语言，通过汇编把高级语言源程序翻译成机器语言目标程序，这种高级语言机器称为间接执行的高级语言机器；另外一种是让高级语言本身就作为机器语言，由硬件或固件逐条解释执行，既不用编译，也不用汇编，这种高级语言机器称为直接执行的高级语言机器。  
难以发展的原因：目前高级语言种类繁多，实际运用中经常使用多种高级语言，如果只适应少数几种高级语言，高级语言机器就难以获得实用。

#### 2.4.4 面向操作系统优化实现改进指令系统的目标和思路

- 通过对操作系统中常用指令和指令串的使用频度进行统计分析来改进；
- 考虑如何增设专用于操作系统的新指令；
- 把操作系统中频繁使用的，对速度影响大的机构型软件子程序硬化或固化，改为直接用硬件或微程序解释实现。

#### 2.4.5 CISC的问题和RISC的优点。

CISC的问题：

- 指令系统庞大，一般指令在200条以上。许多指令功能异常复杂，需要多种寻址方式、指令格式和指令长度；
- 许多指令操作繁杂，执行速度很低，甚至不如用几条简单、基本的指令组合实现；
- 由于指令系统庞大，难以优化生成高效机器语言程序，编译程序太长、太复杂；
- 各种指令的使用频度都不会太多，且差别很大，其中相当一部分指令使用率很低。

RISC的优点:

- 简化了指令系统设计，适合VLSI（超大规模集成电路）实现；
- 提高计算机的执行速度和效率；
- 降低设计成本，提高系统的可靠性；
- 可直接支持高级语言的实现，简化编译程序的设计。

#### 2.4.6 设计RISC的基本原则

- 确定指令系统时，只选择使用频度很高的那些指令，再增加少量能有效支持操作系统、高级语言实现及其他功能的指令；
- 减少指令系统所用的寻址方式，一般不超过两种；
- 让所有指令在一个机器周期内完成；
- 扩大通用寄存器数，一般不少于32个，尽量减少访存；
- 大多数指令采用硬联控制实现，少数指令才用微程序实现；
- 通过精简指令和优化设计编译程序，简单、有效地支持高级语言的实现。

#### 2.4.7 设计RISC的基本技术

- 按设计RISC的基本原则来设计；
- 逻辑实现采用硬联和微程序相结合；
- 在CPU中设置大量工作寄存器并采用重叠寄存器窗口；
- 指令采用流水和延迟转移；
- 采用高速缓冲存储器Cache，设置指令Cache和数据Cache分别存放指令和数据；
- 优化设计编译系统。